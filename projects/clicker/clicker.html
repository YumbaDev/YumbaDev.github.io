<!DOCTYPE html>
<html>
	<head>
		<!-- new -->
		<meta charset="utf-8" />
	
		<title>Clicker</title>
		<link rel="stylesheet" href="style.css">
	</head>
	
	<body>
	
	<div class="info">
		<h1>Clicks: <span id="clicks">0</span><h2>
		
		<p style="margin-top: 0; margin-bottom: 0;">
			<input type="button" value="Click" onclick="manualIncrement()"></input>
		</p>
	</div>
	
	<br />
	
	<div class="info">
		<p style="margin-top: 0; margin-bottom: 0;">
			Current Goal: <span id="clickGoal">0</span>
		</p>
		
		<p style="margin-top: 0; margin-bottom: 0;">
			<input type="button" value="Buy AutoClicker" onclick="buyClicker()"> 
				<span id="numClickers">0</span>
			</input>
		</p>
	</div>
	
	<br />
	
	<div class="resources">
		<p class="Title"><b>Resources</b></p>
		<p class="resource"><img src="sprites/resources/icon_meat.png" class="resource"> Food <span class="data" id="resrcFood">0</span></p>
		<p class="resource"><img src="sprites/resources/icon_wood.png" class="resource"> Wood <span class="data" id="resrcWood">0</span></p>
		<p class="resource"><img src="sprites/resources/icon_stone.png" class="resource"> Stone <span class="data" id="resrcStone">0</span></p>
	</div>
	
	<br />
	
	<div class="minigame_farm">
		<p class="Title"><b>Farm</b></p>
		<canvas tabindex='1' id="farm" width="500" height="300"></canvas>
		<p><b><span id="farmUpdate">The cow sits patiently</span></b></p>
		<p><b><span id="cowClick">0</span></b></p>
	</div>
	
	<br />
	
	<div class="minigame_forest">
		<p class="Title"><b>Forest</b></p>
		<!-- <canvas tabindex='1' id="forest" width="500" height="300"></canvas> -->
	</div>
	
	<br />
	
	<div class="minigame_mine">
		<p class="Title"><b>Mine</b></p>
		<!-- <canvas tabindex='1' id="forest" width="500" height="300"></canvas> -->
	</div>
		
		<script>
		
			// Useful General Functions ////////////////////////////////////////////////////////
			// Get a random integer from range 0, max
			function getRandomInt(max) {
			  return Math.floor(Math.random() * max);
			}
			
			// Canvas Code for FARM /////////////////////////////////////////////////////////////////////
			var canvas_farm = document.getElementById("farm");
			var ctx_farm = canvas_farm.getContext("2d");
		
			let x = canvas_farm.width/2;
			let y = canvas_farm.height/2;
			let dx = .5;
			let dy = -.5;
			let spd = 0;
				
			function draw() {
				//ctx_farm.clearRect(0, 0, canvas_farm.width, canvas_farm.height);
				ctx_farm.fillStyle = "#272c38";
				ctx_farm.fillRect(0, 0, 500, 300);
				
				drawCow();
				
				if(x + dx > canvas_farm.width-50 || x + dx < 0) {
					dx = -dx;
				}
				if(y + dy > canvas_farm.height-50 || y + dy < 0) {
					dy = -dy;
				}
				
				x += dx*spd;
				y += dy*spd;
				
				if(spd > 5) {
					let chance = getRandomInt(750);
					
					if(chance < 4){
					
						// prevent cow from flying off canvas_farm
						if((x > 75 && x < canvas_farm.width - 75) && (y > 75 && x < canvas_farm.height - 75))
							changeCowDir();
					}
				}
				
			}
			setInterval(draw, 10);
			
			// Code to detect where mouse is click in canvas_farm
			function getMousePosition(canvas_farm, event) {
				let rect = canvas_farm.getBoundingClientRect();
				let mouseX = event.clientX - rect.left;
				let mouseY = event.clientY - rect.top;
							
				if(mouseX > x && mouseX < x + 50 && mouseY > y && mouseY > y - 50) {
					clickedOnCow();
				}
			}
		
			canvas_farm.addEventListener("mousedown", function(e)
			{
				getMousePosition(canvas_farm, e);
			});
		
			// Code regarding the Cow ///////////////////////////////////////////////////////////
			let cowClickCount = 0;
			let foodCount = 0;
			
			var cow = new Image();
			cow.src = "sprites/animals/icon_cow.png";
			
			function drawCow() {
				ctx_farm.beginPath();
				ctx_farm.drawImage(cow, x, y, 50, 50);
				ctx_farm.fill();
				ctx_farm.closePath();
			}
			
			function clickedOnCow() {
				spd++;
				cowClickCount++;
				incrementFood();
				document.getElementById("cowClick").innerHTML = cowClickCount;
				
				switch(cowClickCount)
				{
					case 1:
						document.getElementById("farmUpdate").innerHTML = "The cow didn't like that.";
						break;
						
					case 5:
						document.getElementById("farmUpdate").innerHTML = "The cow can now break your ankles.";
						break;
						
					case 10:
						document.getElementById("farmUpdate").innerHTML = "The cow moos in a taunting manner and smirks.";
						break;
				}
			}
			
			// Function to change the cow's direction
			function changeCowDir() {
				dx = -dx;
				dy = -dy;
			}
			
			// Increment Meat
			function incrementFood() {
				foodCount++;
				document.getElementById("resrcFood").innerHTML = foodCount;
			}
			
			////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			
			// Canvas Code for FOREST /////////////////////////////////////////////////////////////////////
			//var canvas_forest = document.getElementById("forest");
			//var ctx_forest = canvas_forest.getContext("2d");
			
			// Code regarding the "CLICKER" portion ////////////////////////////////////
		
			// Variable Initialization /////////////////////////////////////////////////
			let clickCount = 0;
			let numHitGoal = 0;
			let goal = Math.floor(43.443 * Math.pow(Math.E, 1.0381 * numHitGoal)) + 7;
			
			let numClickers = 0;
			
			function initializeVars() {
				document.getElementById("clicks").innerHTML = clickCount;
				document.getElementById("clickGoal").innerHTML = goal;
				document.getElementById("numClickers").innerHTML = numClickers;
			}
			
			initializeVars();
			
			// UPDATE CALL /////////////////////////////////////////////////
			
			var updateClickCount = window.setInterval(function() {
				// We want to update clickCount EVERY frame
				document.getElementById("clicks").innerHTML = clickCount;
				checkGoal();
			}, 500);
		
			// onclick Functions /////////////////////////////////////////////////
			function manualIncrement() {
				clickCount++;
				document.getElementById("clicks").innerHTML = clickCount;
			}
			
			// Goal code /////////////////////////////////////////////////
			function updateGoal() {				
				goal = Math.floor(43.443 * Math.pow(Math.E, 1.0381 * numHitGoal)) + 7;
				
				// We want to update clickGoal ONLY when the condition is met, not EVERY frame
				document.getElementById("clickGoal").innerHTML = goal;
			}
			
			function checkGoal() {
				if(clickCount >= goal)
					{
						numHitGoal++;
						updateGoal();
					}
			}
			
			// Buy Auto Clicker /////////////////////////////////////////////////
			function buyClicker() {
				numClickers++;
				
				// We want to update numClickers ONLY when the condition is met, not EVERY frame
				document.getElementById("numClickers").innerHTML = numClickers;
			}
			
			// Auto Increment /////////////////////////////////////////////////
			function autoIncrement() {
				clickCount += numClickers;
			}
			
			var autoClickAdder = window.setInterval(function() {
				autoIncrement();
			}, 500);
			
		</script>
			
	</body>
</html>
